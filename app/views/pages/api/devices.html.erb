<article>

<aside class="menu">
</br>
<table>
  <tbody>
    <tr><td><a href="" class="upcase"><%= title %></a></td></tr>
    <tr><td>&raquo; <a href="#get-a-device">Get a device</a></td></tr>
    <tr><td>&raquo; <a href="#get-a-device-private-info">Get a device private info</a></td></tr>
    <tr><td>&raquo; <a href="#get-all-devices">Get all devices</a></td></tr>
    <tr><td>&raquo; <a href="#create-a-device">Create a device</a></td></tr>
    <tr><td>&raquo; <a href="#update-a-device">Update a device</a></td></tr>
    <tr><td>&raquo; <a href="#delete-a-device">Delete a device</a></td></tr>
    <tr><td>&raquo; <a href="#update-properties">Update properties</a></td></tr>
    <tr><td>&raquo; <a href="#execute-a-function">Execute a function</a></td></tr>
    <tr><td>&raquo; <a href="#update-physical-access">Update physical access</a></td></tr>
  </tbody>
</table>
</br>
<table>
  <tbody>
    <tr><td><a href="#pending" class="upcase">Advanced</a></td></tr>
    <tr><td>&raquo; <a href="#pending">Pending device</a></td></tr>
    <tr><td>&raquo; <a href="#status">Device status</a></td></tr>
  </tbody>
</table>
</aside>

<h1 class="call"><a name="devices"><%= title %></a></h1>

<p>
A device is everything you interact with everyday of your life. You interact with
lights, appliances, alarms, cooling and heating systems, smoke and gas sensors,
rolling shutters and windows, irrigations, video surveillance, gates, multimedia
(audio and video) and much more.
</p>

<p>
The Device API defines a set of services to create, monitor and control all the devices
in your house. The final goal is to map every device to a unique URI which provides
control over it.

A device is characterized by a <a href="/api/types/">type</a> and from the
<a href="/api/types/properties/">properties</a> it inherits from.
For example creating a dimmer lets the device inherit the <em>status</em>
(<code>on</code> or <code>off</code>) and the <em>intensity</em> (from <code>
0</code> to <code>100</code>) values.
</p>

</article>

<br><br>

<article>

<h1 class="call"><a name="get-a-device">GET /devices/:id</a></h1>

<p>Returns extended information for a given device identified from its ID.</p>

<h4>Resource URL</h4>
<div class="preview">
  <pre><code class="no-highlight">GET http://api.lelylan.com/devices/:id</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#get-a-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#get-a-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#get-a-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="get-a-device-curl">
    <div class="preview">
      <pre><code class="no-highlight">curl http://api.lelylan.com/devices/5042344b95fc441000000001 \
    -H 'Authorization: Bearer &lt;token&gt;'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-a-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-a-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4 id="device-representation">Example body response</h4>

<div class="preview"><pre><code>{
  "uri": "http://api.lelylan.com/devices/5042344b95fc441000000001",
  "id": "5042344b95fc441000000001",
  "name": "Closet dimmer",
  "type": { "uri": "http://api.lelylan.com/types/5042310470eda60a0000000d" },
  "pending": false,
  "created_at": "2012-09-01T16:00:32Z",
  "updated_at": "2012-09-01T16:00:32Z",
  "physical": { "uri": "http://arduino.house.com/5042205c70eda61" },
  "properties": [{
    "uri": "http://api.lelylan.com/properties/50420c7e267ff51000000001",
    "id": "50420c7e267ff51000000001",
    "value": "on",
    "physical": "on"
  }, {
    "uri": "http://api.lelylan.com/properties/50420c3a267ff51300000001",
    "id": "50420c3a267ff51300000001",
    "value": "100",
    "physical": "100"
  }],
}</code></pre></div>

<h4>Body Response explained</h4>

<dl>
  <dd><span>uri</span> - Device URI.</dd>
  <dd><span>id</span> - Device ID.</dd>
  <dd><span>name</span> - Device name.</dd>
  <dd><span>type</span> - Device type. <a href="/api/types">Learn more about</a>.</dd>
  <dd><span>pending</span> - Pending status. <a href="/api/devices/#pending">Learn more about</a>.</dd>
  <dd><span>physical</span> - Connected physical device URI. <a href="/api/physicals">Learn more about</a>.</dd>
  <dt><span>properties</span> - Device properties.</dt>
  <div>
    <dd><span>uri</span> - Property URI.</dd>
    <dd><span>id</span> - Property ID.</dd>
    <dd><span>value</span> - Property value.</dd>
    <dd><span>physical</span> - Physical property value. <a href="/api/devices/#pending">Learn more about</a>.</dd>
  </div>
</dl>

<h2 class="call"><a name="get-a-device-private-info">GET /devices/:id/privates</a></h2>

<p>
Returns private information for a given device identified from its ID.

For security reasons the <a href="#device-representation">device representation</a> does not
show some sensitive information like the device secret and the activation code. The only way to
get them is to use the private service described in this section.
</p>

<p>
<span class="label notice">Notice</span>
To access this service you must be using the <a href="/api/oauth#scopes">privates scope</a>.
</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">GET http://api.lelylan.com/devices/:id/privates</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#get-a-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#get-a-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#get-a-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="get-a-device-curl">
    <div class="preview">
      <pre><code class="no-highlight">curl http://api.lelylan.com/devices/5042344b95fc441000000001 \
    -H 'Authorization: Bearer &lt;token&gt;'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-a-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-a-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>


<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4 id="device-representation">Example body response</h4>

<div class="preview"><pre><code>{
  "uri": "http://api.lelylan.com/devices/5042344b95fc441000000001",
  "id": "5042344b95fc441000000001",
  "name": "Closet dimmer",
  "secret": "0ca70cc411e9e9de25b47b3e76b8a1932ae48bee6e6fa8808b534994dff5045d",
  "activation_code": "3a9e8732e30c7c06031ad28fd5310425bca3d9bc",
}</code></pre></div>

<h4>Body Response explained</h4>

<dl>
  <dd><span>uri</span> - Device URI.</dd>
  <dd><span>id</span> - Device ID.</dd>
  <dd><span>name</span> - Device name.</dd>
  <dd><span>secret</span> - Unique device secret used to secure the communication with the
  physical world. <a href="/api/physicals">Learn more about</a>.</dd>
  <dd><span>activation_code</span> - Device activation code used to claim the device ownership.
  <a href="/api/devices/activations">Learn more about activation</a>.</dd>
</dl>


</article>

<br>

<article>
<h1 class="call"><a name="get-all-devices">GET /devices</a></h1>

<p>Returns a list of owned devices.</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">GET http://api.lelylan.com/devices</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>name</span>
        <span class="info">optional</span>
      </td>
      <td>
        Device name to search.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>type</span>
        <span class="info">optional</span>
      </td>
      <td>
        Type URI to search.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>pending</span>
        <span class="info">optional</span>
      </td>
      <td>
        Device pending status. <a href="/api/devices/#pending">Learn more about</a>. </br>
        <span class="info">Valid values: true, false.</span>
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>physical</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical device URI to search. <a href="/api/physicals">Learn more about</a>
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>properties[uri]</span>
        <span class="info">optional</span>
      </td>
      <td>
        Property URI to search.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>properties[value]</span>
        <span class="info">optional</span>
      </td>
      <td>
        Property value to search.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>properties[physical]</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical value to search. <a href="/api/devices/#pending">Learn more about</a>
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>start</span>
        <span class="info">optional</span>
      </td>
      <td>
        URI of the last fetched record. Learn more about <a href="/api/core/#pagination">pagination</a>.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>per</span>
        <span class="info">optional</span>
        <span class="info">default to '25'</span>
      </td>
      <td>
        Number of resources per page.
      </td>
    </tr>
  </tbody>
</table>


<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#get-all-devices-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#get-all-devices-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#get-all-devices-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="get-all-devices-curl">
    <div class="preview"><pre><code class="no-highlight">curl http://api.lelylan.com/devices?properties[value]=on \
     -H 'Authorization: Bearer &lt;token&gt;'</code></pre></div>
  </div>
  <div class="tab-pane" id="get-all-devices-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-all-devices-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4>Example body response</h4>

<div class="preview"><pre><code class="no-highlight">[
  { # device representation },
  { # device representation },
  ...
]</code></pre></div>

<p>
  See <a href="#device-representation">device representation</a> for body response.
</p>
</article>



<br/>

<article>

<h1 class="call"><a name="create-a-device">POST /devices</a></h1>

<p>
  Create a device and returns extended information for it.
</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">POST  http://api.lelylan.com/devices</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>name</span>
        <span class="info">required</span>
      </td>
      <td>
        Device name.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>type</span>
        <span class="info">required</span>
      </td>
      <td>
        Type URI. <a href="/api/types/">Learn more about</a>.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>physical</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical device URI. <a href="/api/physicals">Learn more about</a>
      </td>
    </tr>
  </tbody>
</table>


<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#create-a-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#create-a-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#create-a-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="create-a-device-curl">
    <div class="preview">
      <pre><code class="no-highlight">curl -X POST http://api.lelylan.com/devices \
     -H 'Authorization: Bearer &lt;token&gt;' \
     -H 'Content-Type: application/json' \
     -d '{
           "name": "Closet dimmer",
           "type": "http://api.lelylan.com/types/5042310470eda60a0000000d",
           "physical": "http://arduino.house.com/5042205c70eda61"
         }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="create-a-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="create-a-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 201 Created
Location: http://api.lelylan.com/devices/5042344b95fc441000000001</code></pre></div>

<h4>Example body response</h4>

<p>
See <a href="#device-representation">device representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="update-a-device">PUT /devices/:id</a></h1>

<p>
Update a device identified from its ID and returns extended information for it.
</p>

<h4>Resource URL</h4>
<div class="preview">
  <pre><code class="no-highlight">PUT  http://api.lelylan.com/devices/:id</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>name</span>
        <span class="info">optional</span>
      </td>
      <td>
        Device name.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>type</span>
        <span class="info">optional</span>
      </td>
      <td>
        Type URI. <a href="/api/types/">Learn more about</a>.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>physical</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical device URI. <a href="/api/physicals">Learn more about</a>
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#update-a-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#update-a-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#update-a-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="update-a-device-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001 \
     -H 'Authorization: Bearer &lt;token&gt;' \
     -H 'Content-Type: application/json' \
     -d '{ "name": "Zigbee closet dimmer" }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-a-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-a-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4>Example body response</h4>

<p>
  See <a href="#device-representation">device representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="delete-a-device">DELETE /devices/:id</a></h1>

<p>
  Delete a device identified from its ID and return extended information for it.
</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">DELETE http://api.lelylan.com/devices/:id</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#delete-a-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#delete-a-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#delete-a-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="delete-a-device-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X DELETE http://api.lelylan.com/devices/5042344b95fc441000000001 \
     -H 'Authorization: Bearer &lt;token&gt;' \
     -H 'Content-Length: 0'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="delete-a-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="delete-a-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4>Example body response</h4>

<p>
  See <a href="#device-representation">device representation</a> for body response.
</p>

</article>

</br>

<article>

<h1 class="call"><a name="update-properties">PUT /devices/:id/properties</a></h1>

<p>
  Update properties on a device identified from its ID and returns extended
  representation for it. If a physical device is connected, Lelylan forward the
  changes to the <a href="/api/physicals">physical world</a>.
</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">PUT http://api.lelylan.com/devices/:id/properties</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>pending</span>
        <span class="info">optional</span>
      </td>
      <td>
        Device pending status. <a href="/api/devices/#pending">Learn more about</a>. </br>
        <span class="info">Valid values: true, false.</span>
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>properties</span>
        <span class="info">required</span>
      </td>
      <td>
        Array of properties to change.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.uri</span>
        <span class="info">required</span>
      </td>
      <td>
        Property URI.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.value</span>
        <span class="info">required</span>
      </td>
      <td>
        Property value.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.physical</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical property value. <a href="/api/devices/#pending">Learn more about</a>
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Requests</h4>

<p>Set the device <code>status</code> to <code>on</code> and the device <code>intensity</code> to <code>50%</code>.</p>

<ul class="nav nav-tabs">
  <li class="active"><a href="#update-properties-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#update-properties-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#update-properties-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="update-properties-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001/properties \
    -H 'Authorization: Bearer &lt;token&gt;' \
    -H 'Content-Type: application/json' \
    -d '{
          "properties": [{
            "uri": "http://api.lelylan.com/properties/50420c7e267ff51000000001",
            "value": "on"
          },{
            "uri": "http://api.lelylan.com/properties/50420c3a267ff51300000001",
            "value": "50" }
          ]
        }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-properties-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-properties-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<div id="physical-request-process">
<%= render 'shared/content/physical_not_physical' %>
</div>

<h4>Example body response</h4>
<p>
  See <a href="#device-representation">device representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="execute-a-function">PUT /devices/:id/functions</a></h1>

<p>
  Execute a function on a device identified from its ID and returns extended representation
  for it. If a physical device is connected, Lelylan forward the changes to the
  <a href="/api/physicals">physical world</a>.
</p>

<h4>Resource URL</h4>
<div class="preview">
<pre><code class="no-highlight">PUT http://api.lelylan.com/devices/:id/functions</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>function</span>
        <span class="info">required</span>
      </td>
      <td>
        Function URI to execute.
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>pending</span>
        <span class="info">optional</span>
      </td>
      <td>
        Device pending status. <a href="/api/devices/#pending">Learn more about</a>. </br>
        <span class="info">Valid values: true, false.</span>
      </td>
    </tr>
    <tr>
      <td class="parameter">
        <span>properties</span>
        <span class="info">optional</span>
      </td>
      <td>
        Array of properties.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.uri</span>
        <span class="info">required</span>
      </td>
      <td>
        Property URI.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.value</span>
        <span class="info">required</span>
      </td>
      <td>
        Property value.
      </td>
    </tr>
    <tr>
      <td class="parameter nested">
        <span>&raquo; property.physical</span>
        <span class="info">optional</span>
      </td>
      <td>
        Physical property value. <a href="/api/devices/#pending">Learn more about</a>.
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Requests</h4>

<p>
<strong>Turn on a device</strong>. In this example we do not send properties because the function
<code>turns on</code> set the property <code>status</code> to <code>on</code> by default.
</p>

<ul class="nav nav-tabs">
  <li class="active"><a href="#execute-a-function-i-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#execute-a-function-i-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#execute-a-function-i-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="execute-a-function-i-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001/functions \
    -H 'Authorization: Bearer &lt;token&gt;' \
    -H 'Content-Type: application/json' \
    -d '{ "function": "http://api.lelylan.com/functions/&lt;turn-on&gt;" }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="execute-a-function-i-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="execute-a-function-i-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<p>
<strong>Set the device intensity to 90%</strong>. In this example the function sets the
property <code>status</code> to <code>on</code> by default and expects the intensity value
to be sent from the user.
</p>

<ul class="nav nav-tabs">
  <li class="active"><a href="#execute-a-function-ii-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#execute-a-function-ii-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#execute-a-function-ii-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="execute-a-function-ii-curl">
    <div class="preview">
      <div class="preview">
        <pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001/functions \
    -H 'Authorization: Bearer &lt;token&gt;' \
    -H 'Content-Type: application/json' \
    -d '{
          "function": "http://api.lelylan.com/functions/&lt;set-intensity&gt;"
          "properties": [{
            "uri": "http://api.lelylan.com/properties/&lt;intensity&gt;",
            "value": "90" }
          ]
        }'</code></pre>
      </div>
    </div>
  </div>
  <div class="tab-pane" id="execute-a-function-ii-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="execute-a-function-ii-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<p>
  <span class="label notice">Notice</span>
  To deeply understand how functions work check out the
  <a href="/api/types/functions">functions API</a>.
</p>

<%= render 'shared/content/physical_not_physical' %>

<h4>Example body response</h4>
<p>
  See <a href="/api/devices/#device-representation">device representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="update-physical-access">PUT /devices/:id/accesses</a></h1>

<p>
Authorize the <a href="/api/physicals/">physical device</a> to send updates the device
identified from its ID. This service sends the device URI and an access token as required
from the <a href="/api/physicals/#update-physical-configuration">physical device API</a>.

<p>
Keep in mind a couple of important things.
</p>

<ul>
  <li>This service works only if the device has a
  <a href="#device-representation">physical URI</a> connection.</li>
  <li>To make this service work you and the physical device must be connected to internet.</li>
  <li>The generated token is authorized to access only the
  <a href="/api/oauth#filtering-resources">device identified from its ID</a>.</li>
  <li>This service must be used to let the physical device
  <a href="/api/physicals/#update-device-properties">send updates to Lelylan</a>.</li>
</ul>

<h4>Resource URL</h4>
<div class="preview">
  <pre><code class="no-highlight">PUT  http://api.lelylan.com/devices/:id/accesses</code></pre>
</div>

<h4>Parameters</h4>

<table class="zebra-striped">
  <tbody>
    <tr>
      <td class="parameter">
        <span>id</span>
        <span class="info">required</span>
      </td>
      <td>
        The ID of the desired device.
      </td>
    </tr>
  </tbody>
</table>

<h4>Example Request</h4>

<ul class="nav nav-tabs">
  <li class="active"><a href="#update-physical-access-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#update-physical-access-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#update-physical-access-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="update-physical-access-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001/accesses \
     -H 'Authorization: Bearer &lt;token&gt;' \
     -H 'Content-Type: application/json'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-physical-access-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-physical-access-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<p>
When making the request, a new one is automatically sent to the physical device URI with
the device uri and with the new access token.
<a href="/api/physicals/#update-physical-configuration">Learn more about</a>.
</p>

<ul class="nav nav-tabs">
  <li class="active"><a href="#update-physical-access-sent-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li><a href="#update-physical-access-sent-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li><a href="#update-physical-access-sent-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="update-physical-access-sent-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://arduino.house.com/5042205c70eda61 \
    -H 'Content-Type: application/json' \
    -H 'X-Physical-Signature: 6e3f998e7f7bf27b8fa6ff426b0a980465aa8468' \
    -d '{
          "nonce": "beb11631-070a-484f-9980-5a6fa8469bb5",
          "device": "http://api.lelylan.com/devices/5042344b95fc441000000001",
          "access_token": "d1eca7d40ab4915291b9aa0a859ecaab69bbd6829635a68dd6b7a3952de93f77"
        }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-physical-access-sent-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-physical-access-sent-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<h4>Example header response</h4>

<div class="preview"><pre><code class="no-highlight">HTTP/1.1 200 OK</code></pre></div>

<h4>Example body response</h4>

<p>
  See <a href="#device-representation">device representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="pending">Pending device explained</a></h1>

<p>
A device connected to the physical world does not change instantaneously. Think at when you
open a roller shutter. From the moment you send the open request, and the moment it's
physically open, a few seconds are needed. During this period of time the device is defined
as <strong>pending</strong>, as it's waiting for its final status to be reached.
</p>

<h2>Get all pending devices</h2>

<ul class="nav nav-tabs">
  <li class="curl active"><a href="#get-all-pending-devices-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li class="javascript"><a href="#get-all-pending-devices-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li class="ruby"><a href="#get-all-pending-devices-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="get-all-pending-devices-curl">
    <div class="preview">
        <pre><code class="no-highlight">curl http://api.lelylan.com/devices?pending=true \
     -H 'Authorization: Bearer &lt;token&gt;'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-all-pending-devices-javascript">
    <div class="preview">
        <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="get-all-pending-devices-ruby">
    <div class="preview">
        <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<p>
In this example we get one pending resource related to a rolling shutter that has to
reach the aperture level of <code>100%</code>. The physical device aperture is at
<code>28%</code> when the request is executed.
</p>

<div class="preview"><pre><code>[{
  "uri": "http://api.lelylan.com/devices/4dece6f3d033a9b9a90000a1",
  "id": "4dece6f3d033a9b9a90000a1",
  "name": "Rolling shutter",
  "pending": true,
  "physical": { "uri": "http://arduino.house.com/5042205c70eda61" },
  "properties": [{
    "uri": "http://api.lelylan.com/properties/4decdd07d033a95e25000046",
    "id": "4decdd07d033a95e25000046",
    "value": "100",
    "physical": "28"
  }],
  "created_at": "2012-09-01T16:00:32Z",
  "updated_at": "2012-09-01T16:00:32Z"
}]</code></pre></div>

</br>
<h2>Set device as pending</h2>

<p>Update the aperture <code>level</code> to <code>46%</code> and set the pending status
to <code>true</code>.

<ul class="nav nav-tabs">
  <li class="curl active"><a href="#update-pending-device-curl" data-toggle="tab" class="curl">Curl</a></li>
  <li class="javascript"><a href="#update-pending-device-javascript" data-toggle="tab" class="javascript">Javascript</a></li>
  <li class="ruby"><a href="#update-pending-device-ruby" data-toggle="tab" class="ruby">Ruby</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="update-pending-device-curl">
    <div class="preview"><pre><code class="no-highlight">curl -X PUT http://api.lelylan.com/devices/5042344b95fc441000000001/properties \
    -H 'Authorization: Bearer &lt;token&gt;' \
    -H 'Content-Type: application/json' \
    -d '{
          "pending": true,
          "properties": [{
            "uri": "http://api.lelylan.com/properties/50420c3a267ff51300000001",
            "physical": "46"
          }]
         }'</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-pending-device-javascript">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
  <div class="tab-pane" id="update-pending-device-ruby">
    <div class="preview">
      <pre><code># todo</code></pre>
    </div>
  </div>
</div>

<p>
<span class="label notice">Notice</span>
The pending resource makes sense when a device is connected to a
<a href="/api/devices/physical/">physical device</a> as its main goal is to reflect
the changes of the physical world. Anyway, you can easily simulate the physical world
setting the <code>physical</code> property whenever you need it.
</p>

<h4>Example body response</h4>

<p>
See <a href="#device-representation">pending representation</a> for body response.
</p>

</article>

<br/>

<article>

<h1 class="call"><a name="status">Device status explained</a></h1>

<p>
Sometimes properties are not enough to describe the device status.
Think at a roller shutter for example. It has the property <code>status</code>
that accepts the values <code>open</code> and <code>close</code>. Now think at
what happens when a roller shutter is opening. It is neither open or close, but just
opening. To have a complete control over the device at every moment of its life use the
status resource.
</p>

<p>
Right now this service is not available on server side. To get the device status you must
use one of the existing <a href="/community/clients/">javascript libraries</a>.
This decision is due to performance motivation and to the fact that the status information
is a client visualization tasks.
</p>

<ul class="nav nav-tabs">
  <li class="active" data-toggle="tab" class="javascript"><a href="#get-status-javascript">Javascript</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="get-status-javascript">
    <div class="preview">
      <pre><code>device = Device.find(uri);
status = device.status();</code></pre>
    </div>
  </div>
</div>

<p>
In this example we show how to get the device status. Just find the device through
its id and call the <code>status()</code> method. See the
<a href="/api/types/statuses/#status-representation">status representation</a> to
get an idea of its structure.
</p>

<p>
<span class="label notice">Notice</span>
If you think that this functionality must be present in the server side
<a href="/community/support/">write us</a> your use cases and why you need it.
We are open to discussions.
</p>

</article>
